---
- name: Install dist2src worker
  hosts: all
  vars:
    home_path: "{{ lookup('env', 'HOME') }}"
  tasks:
    - name: Install dist2src
      pip:
        name: /src
        executable: pip3
    - name: Clean all the cache files (especially pip)
      file:
        state: absent
        path: ~/.cache/
    - name: Copy run_worker.sh
      copy:
        src: run_worker.sh
        dest: /usr/bin/run_worker.sh
        mode: 0777
    - name: Create packit home dir
      file:
        state: directory
        path: "{{ home_path }}"
        mode: 0776
